# Image Stream

* [is@os.doc](https://docs.openshift.com/container-platform/3.11/architecture/core_concepts/builds_and_image_streams.html#image-streams)
* [managing_images@os.doc](https://docs.openshift.com/container-platform/3.11/dev_guide/managing_images.html)
* [OpenShift Image Streams and Templates library](https://github.com/openshift/library)

## understand cakephp-mysql-example template

[cakephp-mysql-example.yaml](../files/cakephp-mysql-example.yaml): which is generated by `oc get template -n openshift cakephp-mysql-example -o yaml > ~/cakephp-mysql-example.yaml` on OCP 4 (4.0.0-0.nightly-2019-03-06-074438).

```
$ oc new-project ttt
$ oc new-app --template=cakephp-mysql-example
$ oc get bc cakephp-mysql-example -o yaml | grep "name: php"
        name: php:7.1
### for any reason if the istags are not generated automatically on the cluster installation time, we can import them manually
### by default: this bc requires istag "php:7.1" in ns "openshift"
### and `oc import-image -n openshift php` only generates the istags "latest" and "php:7.2"
### we need to import image with more specific tag
$ oc import-image -n openshift php:7.1
### the output of this bc: is "cakephp-mysql-example:latest"

$ oc get dc mysql 
NAME    REVISION   DESIRED   CURRENT   TRIGGERED BY
mysql   1          1         1         config,image(mysql:5.7)
### it requires istag "mysql:5.7" in ns "openshift"

$ oc import-image -n openshift mysql:5.7

### when those 2 istags are generated, everything should be in the right position.
### if not, we can clean up and redeploy the template
$ oc get istag -n openshift mysql:5.7 php:7.1
NAME        IMAGE REF                                                                                                                                  UPDATED
mysql:5.7   image-registry.openshift-image-registry.svc:5000/openshift/mysql@sha256:66713598d04d7b8cc5919710ee4fe3240a5f93b9f9cbad90587f055007922e3d   About a minute ago
NAME        IMAGE REF                                                                                                                                  UPDATED
php:7.1     image-registry.openshift-image-registry.svc:5000/openshift/php@sha256:3895d8c39906fb07578ad5eb6dbdfb91471d2ebba570c67b2a1fccdf56c40c20     12 minutes ago

### everything is in order
$ oc get dc
NAME                    REVISION   DESIRED   CURRENT   TRIGGERED BY
cakephp-mysql-example   1          1         1         config,image(cakephp-mysql-example:latest)
mysql                   1          1         1         config,image(mysql:5.7)

$ oc get pod
NAME                               READY   STATUS      RESTARTS   AGE
cakephp-mysql-example-1-build      0/1     Completed   0          2m46s
cakephp-mysql-example-1-deploy     0/1     Completed   0          68s
cakephp-mysql-example-1-hook-pre   0/1     Completed   0          61s
cakephp-mysql-example-1-qfcnq      1/1     Running     0          40s
mysql-1-deploy                     0/1     Completed   0          2m46s
mysql-1-w44fx                      1/1     Running     0          2m36s

$ oc get routes.route.openshift.io 
NAME                    HOST/PORT                                                                       PATH   SERVICES                PORT    TERMINATION   WILDCARD
cakephp-mysql-example   cakephp-mysql-example-ttt.apps.walid03006074438m5.qe.devcluster.openshift.com          cakephp-mysql-example   <all>                 None


$ curl -s -o /dev/null -I -w "%{http_code}" cakephp-mysql-example-ttt.apps.walid03006074438m5.qe.devcluster.openshift.com
200

```